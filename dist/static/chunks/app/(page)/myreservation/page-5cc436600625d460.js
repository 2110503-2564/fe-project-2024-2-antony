(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[786],{1307:(e,t,a)=>{Promise.resolve().then(a.bind(a,7311))},6510:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var r=a(5155);function s(e){let{onClose:t,onDelete:a,title:s}=e;return(0,r.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-8 w-full max-w-xl",children:[(0,r.jsx)("div",{className:"mb-4 w-full",children:(0,r.jsx)("label",{className:"block text-lg font-semibold mb-2 w-full text-center",children:s})}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{onClick:t,className:"w-full bg-gray-800 text-white py-3 rounded-lg font-semibold text-lg hover:bg-gray-700 hover:cursor-pointer transition",children:"Cancel"}),(0,r.jsx)("button",{onClick:a,className:"w-full bg-red-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-red-500 hover:cursor-pointer transition",children:"Delete"})]})]})}},6771:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=async()=>{let e=await fetch("https://antony-massage-backend-production.up.railway.app/api/v1/massage-shops");if(!e.ok)throw Error("Failed to fetch shops");return await e.json()}},7311:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var r=a(5155),s=a(2115),o=a(5695);function l(e){let{reserve:t,onEdit:a,onDelete:s,isAdmin:o}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-100 rounded-lg shadow-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:t.massageShop.name}),o&&(0,r.jsxs)("p",{className:"text-gray-500",children:["Reserver ID: ",t.user]}),(0,r.jsx)("p",{className:"text-gray-500",children:new Date(t.reserveDate).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"})})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{className:"bg-gray-800 hover:bg-gray-700 hover:cursor-pointer text-white px-4 py-2 rounded-lg",onClick:a,children:"Edit"}),(0,r.jsx)("button",{className:"bg-red-600 hover:bg-red-500 hover:cursor-pointer text-white px-4 py-2 rounded-lg",onClick:s,children:"Delete"})]})]})}async function n(){try{let e=localStorage.getItem("token");if(!e)throw Error("No token found");let t=await fetch("https://antony-massage-backend-production.up.railway.app/api/v1/reservations",{headers:{Authorization:"Bearer ".concat(e)}}),a=await t.json();if(!t.ok)throw Error("Failed to fetch reservations: ".concat(a.message||"Unknown error"));return a.data}catch(e){console.error("Error during fetching reservations:",e)}}async function i(e,t){try{if(!t){alert("You need to be logged in to delete a reservation.");return}let a=await fetch("https://antony-massage-backend-production.up.railway.app/api/v1/reservations/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}),r=await a.text();if(!a.ok)throw console.error("API Error:",r),Error("Delete reservation failed");return JSON.parse(r)}catch(e){throw e}}var c=a(9216),d=a(6771);function u(e){let{reservationId:t,reservationShopId:a,reservationDate:l,onClose:n,onUpdate:i}=e,[u,h]=(0,s.useState)([]),[g,p]=(0,s.useState)(a),[x,m]=(0,s.useState)(l),f=(0,o.useRouter)();return(0,s.useEffect)(()=>{if(!localStorage.getItem("token")){f.push("/login");return}(async()=>{try{let e=await (0,d.A)();h(e.data)}catch(e){console.error("Failed to fetch shops:",e)}})()},[f]),(0,r.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-8 w-full max-w-xl",children:[(0,r.jsxs)("div",{className:"mb-4 w-full",children:[(0,r.jsx)("label",{className:"block text-lg font-semibold mb-2 w-full",children:"Date Reservation"}),(0,r.jsx)(c.A,{selectedDate:x,setSelectedDate:m})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-lg font-semibold mb-2",children:"Massage Shop"}),(0,r.jsxs)("select",{className:"w-full rounded-lg p-3 bg-gray-100 text-gray-700 hover:cursor-pointer",value:g,onChange:e=>p(e.target.value),children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"Select Massage Shop"}),u.map(e=>(0,r.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,r.jsxs)("div",{className:"flex gap-4",children:[(0,r.jsx)("button",{onClick:n,className:"w-full bg-gray-800 text-white py-3 rounded-lg font-semibold text-lg hover:bg-gray-700 hover:cursor-pointer transition",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{if(!g||!x){alert("Please select a shop and a date.");return}console.log("Before update - Shop ID:",g,"Date:",x),i(t,{massageShopId:g,reserveDate:x.format("YYYY-MM-DD")}),console.log("Updated data passed to onUpdate:",{massageShopId:g,reserveDate:x.format("YYYY-MM-DD")}),n()},className:"w-full bg-green-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-green-500 hover:cursor-pointer transition",children:"Update"})]})]})}async function h(e){let{reservationId:t,massageShopId:a,reserveDate:r,token:s}=e;try{let e=await fetch("https://antony-massage-backend-production.up.railway.app/api/v1/reservations/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({reserveDate:r,massageShop:a})}),o=await e.text();if(!e.ok)throw console.error("API Error:",o),Error("Update reservation failed");return JSON.parse(o)}catch(e){throw e}}var g=a(832),p=a.n(g),x=a(9915),m=a(6510);function f(){let[e,t]=(0,s.useState)([]),[a,c]=(0,s.useState)(!0),[d,g]=(0,s.useState)(""),[f,v]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[y,j]=(0,s.useState)(null),[N,S]=(0,s.useState)(!1),[k,D]=(0,s.useState)(!1),[E,I]=(0,s.useState)(null),C=(0,o.useRouter)();(0,s.useEffect)(()=>{try{let e=localStorage.getItem("user");if(e){let t=JSON.parse(e);"admin"===t.role?S(!0):S(!1)}}catch(e){console.error("Failed to parse user data",e),localStorage.removeItem("user")}},[]),(0,s.useEffect)(()=>{(async()=>{if(!localStorage.getItem("token")){C.push("/login");return}try{let e=await n();t(e||[])}catch(e){g(e.message||"Failed to load reservations")}finally{c(!1)}})()},[C]);let A=(e,t,a)=>{v(e),w(t),j(p()(a))},_=e=>{D(!0),I(e)},Y=async()=>{if(null!=E)try{let e=localStorage.getItem("token");await i(E,e||""),D(!1),I(null);let a=await n();alert("Delete Reservation successful!"),t(a||[])}catch(e){console.error("Error deleting reservation:",e)}},F=async(e,a)=>{try{let r=localStorage.getItem("token");await h({reservationId:e,...a,token:r||""});let s=await n();alert("Update Reservation successful!"),t(s||[]),v(null)}catch(e){console.error("Error updating reservation:",e)}};return a?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen space-y-4",children:[(0,r.jsx)(x.A,{sx:{color:"rgb(220, 38, 38)"},size:60,thickness:5}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-600",children:"Loading..."})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center p-10 w-full",children:[(0,r.jsx)("div",{className:"w-full max-w-4xl space-y-4 mt-15",children:e.length>0?e.map(e=>(0,r.jsx)(l,{reserve:e,onEdit:()=>A(e._id,e.massageShop._id,e.reserveDate),onDelete:()=>_(e._id),isAdmin:N},e._id)):(0,r.jsx)("p",{className:"text-center text-gray-600 text-lg",children:N?"Don't have any reservations.":"You don't have any reservations."})}),f&&b&&y&&(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-[rgba(0,0,0,0.5)]",children:(0,r.jsx)(u,{reservationId:f,reservationShopId:b,reservationDate:y,onClose:()=>{v(null),w(null),j(null)},onUpdate:F})}),k&&(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-[rgba(0,0,0,0.5)]",children:(0,r.jsx)(m.A,{onClose:()=>{D(!1),I(null)},onDelete:Y,title:"Are you sure you want to delete this reservation?"})})]})}},9216:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(5155),s=a(7404),o=a(5571),l=a(9952);function n(e){let{selectedDate:t,setSelectedDate:a}=e;return(0,r.jsx)(o.$,{dateAdapter:l.R,children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(s.l,{className:"w-full bg-gray-100",value:t,onChange:e=>a(e),slotProps:{textField:{sx:{width:"100%",backgroundColor:"#F3F4F6",borderRadius:"8px",color:"#374151","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}},"& .MuiInputBase-input":{color:"#374151",fontSize:"16px",height:"10px"},"& .MuiSvgIcon-root":{color:"#374151"}}}}})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[484,404,441,684,358],()=>t(1307)),_N_E=e.O()}]);